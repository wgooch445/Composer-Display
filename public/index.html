<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
content="width=device-width,
initial-scale=1.0">
    <title>Troubleshooting Notes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Troubleshooting notes</h1>
    <div class="search-container">
    <input type="text" id="searchInput"
        placeholder="Search by keyword">
    </div>
   <div class="table-responsive">
       <table id="data-table">
        <thead>
            <tr>
                <th>Document #</th>
                <th>HelpDesk Tech</th> 
                <th>Troubleshooting Steps</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
       </table>
   </div>

    <script>
    let allDocuments = []; // This will store the full list of documents

    document.addEventListener('DOMContentLoaded', async () => {
        const tableBody = document.querySelector('#data-table tbody');
        // FIX 1: Missing opening quote for 'searchInput' string literal in getElementById
        const searchInput = document.getElementById('searchInput'); // Corrected from getElementById(searchInput')

        try {
            const response = await fetch('/api/documents');
            if (!response.ok) {
                // FIX 2: Corrected template literal syntax from status ${response.status}
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            // FIX 3: Consistent casing for 'allDocuments' (it was 'alldocuments' in initial display call)
            allDocuments = await response.json(); 

            // Initial display of all documents after fetching
            // FIX 3: Consistent casing for 'allDocuments'
            displayDocuments(allDocuments);

            // Add event listener for search input
            // FIX 4: Added a missing closing parenthesis for the addEventListener's arrow function
            searchInput.addEventListener('keyup', () => { 
                const searchTerm = searchInput.value.toLowerCase(); 
                const filteredDocuments = allDocuments.filter(doc => {
                    // FIX 5: Inconsistent field name 'Help Desk tech' vs 'Help Desk Tech'
                    // FIX 6: Missing quotes around 'Help Desk tech' when accessing doc property
                    const tech = doc["Help Desk Tech"] ? doc["Help Desk Tech"].toLowerCase() : ''; // Corrected from doc[Help Desk tech"]

                    // FIX 7: Consistent field name 'Troubleshooting Steps ' vs 'Troubleshooting steps ' (if trailing space is in DB)
                    // Ensure this EXACTLY matches your MongoDB field name, including any trailing spaces or capitalization
                    const steps = doc["Troubleshooting steps "] ? doc["Troubleshooting steps "].toLowerCase() : ''; 

                    return tech.includes(searchTerm) || steps.includes(searchTerm);
                });
                displayDocuments(filteredDocuments);
            }); // This closes the keyup event listener's callback function

        } catch (error) {
            // Display a user-friendly error message on the page
            tableBody.innerHTML = '<tr><td colspan="3">Error loading data. Please check server logs or network.</td></tr>';
            // Log the full error to the browser's console for debugging
            console.error("Error fetching or displaying documents:", error);
        }
    }); // This closes the DOMContentLoaded event listener's callback function


    // Function to display documents (reusable for initial load and filtering)
    function displayDocuments(documentsToDisplay) { 
        const tableBody = document.querySelector('#data-table tbody'); // Select the tbody element

        // FIX 8: 'documents' variable in this function refers to 'documentsToDisplay' parameter.
        // It should be 'documentsToDisplay.length' here, not 'documents.length'.
        if (documentsToDisplay.length === 0) { 
            tableBody.innerHTML = '<tr><td colspan="3">No matching documents found.</td></tr>';
        } else {
            tableBody.innerHTML = ''; // Clear existing content

            documentsToDisplay.forEach((doc, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td> 
                    <td>${doc["Help Desk Tech"]}</td> 
                    <td>${doc["Troubleshooting steps "]}</td> 
                `;
                tableBody.appendChild(row); 
            });
        }
    } // This closes the displayDocuments function
</script>


</body>
</html>

